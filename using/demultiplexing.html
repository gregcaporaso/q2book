
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4. Demultiplexing a sequencing run &#8212; q2book</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.37f24b989f4638ff9c27c22dc7559d4f.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Denoising demultiplexed sequencing data" href="denoising.html" />
    <link rel="prev" title="3. Importing data into QIIME 2" href="importing.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">q2book</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../front-matter/preface.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Front Matter
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../front-matter/reading.html">
   1. Reading this book
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Microbiome Bioinformatics with QIIME 2
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="getting-started.html">
   1. Getting started with using QIIME 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="overview-tutorial.html">
   2. An interactive overview of QIIME 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="importing.html">
   3. Importing data into QIIME 2
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   4. Demultiplexing a sequencing run
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="denoising.html">
   5. Denoising demultiplexed sequencing data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="taxonomy.html">
   6. Taxonomic annotation and analysis of sequences
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Understanding the algorithms
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../algorithms/pairwise-alignment.html">
   1. Pairwise sequence alignment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../algorithms/database-searching.html">
   2. Sequence homology searching
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Developing with QIIME 2
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../developing/getting-started.html">
   1. Getting started with developing with QIIME 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../developing/first-plugin.html">
   2. Building a first plugin
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Back Matter
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../back-matter/importing-examples.html">
   1. Examples illustrating importing data into QIIME 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../back-matter/biological-information.html">
   2. Appendix 1: Biological Information
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../back-matter/microbiome-methods.html">
   3. Appendix 2: A brief introduction to methods in microbiome science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../back-matter/q2-origin-story.html">
   4. Appendix 3: History of the QIIME platform
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../back-matter/glossary.html">
   5. Glossary
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/using/demultiplexing.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   4.1. Demultiplexing …
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="demultiplexing-a-sequencing-run">
<span id="demultiplexing"></span><h1><span class="section-number">4. </span>Demultiplexing a sequencing run<a class="headerlink" href="#demultiplexing-a-sequencing-run" title="Permalink to this headline">¶</a></h1>
<p><strong>TODO: All content is currently copy/pasted from its previous home in the overview tutorial chapter. I decided to simplify that chapter as much as possible. This content will need to be contextualized for this chapter.</strong></p>
<p>The second file that we downloaded above was our multiplexed sequence data. This is sequencing data as it came off an Illumina DNA sequencing instrument. At this stage, the sequences are all grouped together - they are not grouped by sample. Instead, during sample preparation (PCR specifically), a short DNA sequence referred to as an index or a barcode was added to sequences on a per-sample basis. For example, <code class="docutils literal notranslate"><span class="pre">sample-1</span></code> might be assigned the barcode <code class="docutils literal notranslate"><span class="pre">TGACCGTACGTA</span></code>, and <code class="docutils literal notranslate"><span class="pre">sample-2</span></code> might be assigned the barcode <code class="docutils literal notranslate"><span class="pre">TGGTAGACCCGT</span></code>. All sequences derived from <code class="docutils literal notranslate"><span class="pre">sample-1</span></code> will have the <code class="docutils literal notranslate"><span class="pre">sample-1</span></code> barcode associated with them, and all sequences derived from <code class="docutils literal notranslate"><span class="pre">sample-2</span></code> will have the <code class="docutils literal notranslate"><span class="pre">sample-2</span></code> barcode associated with them. One piece of sample metadata in our sample metadata file is the barcode sequence associated with each sample. Assign sequences to the sample they are derived from is referred to as <em>demultiplexing</em> the sequencing run. The <code class="docutils literal notranslate"><span class="pre">q2-demux</span></code> plugin in QIIME 2 has several methods for demultiplexing sequencing runs. These take the sequencing data as input, as well as the sample metadata.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Demux</em> is a common abbreviation for <em>demultiplex</em>. For example, if someone asks if your sequence data is demuxed, they’re probably wondering whether the sequences from your samples are all group together (i.e., they are multiplexed), or if they have already been associated with the samples they are derived from (i.e., they are demultiplexed).</p>
</div>
</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can start a QIIME 2 analysis with data is that is multiplexed, as illustrated here, or data that is demultiplexed. Personally I prefer to start with data that is already demultiplexed - I typically ask the group doing the sequencing for me to demultiplex the data before delivering it. Because different sequencing centers use different multiplexing strategies (e.g., single barcoding versus dual barcoding) I find that this is easier because I don’t have to figure out how they barcoded the data, and then figure out how to demultiplex it. Since they know how they barcoded the data, they’ll know how to demultiplex it. This is still a bit of a personal preference though: one option is not necessarily better than the other, and you can start your analysis with whatever you have. You’ll probably develop your own preference as you gain experience.</p>
</div>
</div>
<div class="section" id="id1">
<h2><span class="section-number">4.1. </span>Demultiplexing …<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>As a first analysis step with QIIME 2, demultiplex the sequence data with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qiime</span> <span class="n">demux</span> <span class="n">emp</span><span class="o">-</span><span class="n">paired</span> \
  <span class="o">--</span><span class="n">i</span><span class="o">-</span><span class="n">seqs</span> <span class="n">emp</span><span class="o">-</span><span class="n">paired</span><span class="o">-</span><span class="n">end</span><span class="o">-</span><span class="n">sequences</span><span class="o">.</span><span class="n">qza</span> \
  <span class="o">--</span><span class="n">m</span><span class="o">-</span><span class="n">barcodes</span><span class="o">-</span><span class="n">file</span> <span class="n">sample</span><span class="o">-</span><span class="n">metadata</span><span class="o">.</span><span class="n">tsv</span> \
  <span class="o">--</span><span class="n">m</span><span class="o">-</span><span class="n">barcodes</span><span class="o">-</span><span class="n">column</span> <span class="n">barcode</span><span class="o">-</span><span class="n">sequence</span> \
  <span class="o">--</span><span class="n">p</span><span class="o">-</span><span class="n">rev</span><span class="o">-</span><span class="n">comp</span><span class="o">-</span><span class="n">mapping</span><span class="o">-</span><span class="n">barcodes</span> \
  <span class="o">--</span><span class="n">o</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">sample</span><span class="o">-</span><span class="n">sequences</span> <span class="n">demux</span><span class="o">.</span><span class="n">qza</span> \
  <span class="o">--</span><span class="n">o</span><span class="o">-</span><span class="n">error</span><span class="o">-</span><span class="n">correction</span><span class="o">-</span><span class="n">details</span> <span class="n">demux</span><span class="o">-</span><span class="n">log</span><span class="o">.</span><span class="n">qza</span>
</pre></div>
</div>
<p>Since this is one of the first QIIME 2 commands that you’ve run (at least while reading this book) let’s take a look at it in some detail. As we look at this command, I’m going to assume that you either have some command line software experience, or that you’ve read <em>the introductory chapter in this book on using the command line</em> (<strong>TODO: this chapter doesn’t exist yet.</strong>). There are four components to notice on the first line of this command, and as is typically the case when running command line software, the command’s components are separated by spaces. The first space-separated component is <code class="docutils literal notranslate"><span class="pre">qiime</span></code>. This tells your computer that the QIIME 2 program should be run. The second space-separated component is <code class="docutils literal notranslate"><span class="pre">demux</span></code>. This is the name of the q2-demux plugin, as far as QIIME 2 is concerned, so this tells QIIME 2 that you want to use the <code class="docutils literal notranslate"><span class="pre">q2-demux</span></code> plugin. The third space-separated component is <code class="docutils literal notranslate"><span class="pre">emp-paired</span></code>, which is an action in the q2-demux plugin. This action demultiplexes paired-end sequencing data that is formatted as is typical for Earth Microbiome Project (EMP) sequenced data (more on that later). As mentioned in the previous chapter, if you’d like to learn about this action, you could run the command <code class="docutils literal notranslate"><span class="pre">qiime</span> <span class="pre">demux</span> <span class="pre">emp-paired</span> <span class="pre">--help</span></code>, which will print help text to the screen. Finally, the <code class="docutils literal notranslate"><span class="pre">\</span></code> at the end of the line is worth mentioning now. When you’re working on the command line, line breaks (i.e., the character that is received when you press the <em>Return</em> key on your keyboard) signifies that you have finished entering the command and that the command should now be executed (i.e., run). Since QIIME 2 commands can be long, it’s helpful when documenting them to split them over multiple lines so that they can be read without the reader having to scroll to the right. If the documentation is being presented in a non-interactive medium, such as a printed book, the formatting of the command could actually be misleading - for example, it could look like the command should be split across multiple lines. Splitting long commands across multiple lines also therefore helps to ensure accuracy of the documentation and it improves readability. The <code class="docutils literal notranslate"><span class="pre">\</span></code> character here simply means that the terminal shouldn’t interpret the line break that follows it as the end of the command, but rather that the command will continue on the next line. The same command, without the line breaks, would look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qiime</span> <span class="n">demux</span> <span class="n">emp</span><span class="o">-</span><span class="n">paired</span> <span class="o">--</span><span class="n">i</span><span class="o">-</span><span class="n">seqs</span> <span class="n">emp</span><span class="o">-</span><span class="n">paired</span><span class="o">-</span><span class="n">end</span><span class="o">-</span><span class="n">sequences</span><span class="o">.</span><span class="n">qza</span> <span class="o">--</span><span class="n">m</span><span class="o">-</span><span class="n">barcodes</span><span class="o">-</span><span class="n">file</span> <span class="n">sample</span><span class="o">-</span><span class="n">metadata</span><span class="o">.</span><span class="n">tsv</span> <span class="o">--</span><span class="n">m</span><span class="o">-</span><span class="n">barcodes</span><span class="o">-</span><span class="n">column</span> <span class="n">barcode</span><span class="o">-</span><span class="n">sequence</span> <span class="o">--</span><span class="n">p</span><span class="o">-</span><span class="n">rev</span><span class="o">-</span><span class="n">comp</span><span class="o">-</span><span class="n">mapping</span><span class="o">-</span><span class="n">barcodes</span> <span class="o">--</span><span class="n">o</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">sample</span><span class="o">-</span><span class="n">sequences</span> <span class="n">demux</span><span class="o">.</span><span class="n">qza</span> <span class="o">--</span><span class="n">o</span><span class="o">-</span><span class="n">error</span><span class="o">-</span><span class="n">correction</span><span class="o">-</span><span class="n">details</span> <span class="n">demux</span><span class="o">-</span><span class="n">log</span><span class="o">.</span><span class="n">qza</span>
</pre></div>
</div>
<p>That command will do the exact same thing as the one above. I think you’ll agree though that the first variant, where the command is split across multiple lines, is easier to read.</p>
<p>After we specify the program (<code class="docutils literal notranslate"><span class="pre">qiime</span></code>), the plugin (<code class="docutils literal notranslate"><span class="pre">demux</span></code>), and the action (<code class="docutils literal notranslate"><span class="pre">emp-paired</span></code>) that we want to run, we provide options to that action to tell it what files we want it to operate on, what we want it to do exactly, and what we want the outputs to be called. These components of the command are specified on the remaining lines. Let’s look at those now.</p>
<p>This action takes one QIIME 2 artifact as input, the multiplexed sequences that we downloaded above. In the QIIME 2 command line interface, input artifacts are always specified with options beginning with <code class="docutils literal notranslate"><span class="pre">--i-</span></code>. This action also takes a metadata file and a metadata column, both of which are specified with options beginning with <code class="docutils literal notranslate"><span class="pre">--m-</span></code> (where the <em>m</em> implies <em>metadata</em>). Here, these specify the file containing the metadata (that’s the second file that we downloaded above) and column header in that file that contains the barcode sequences. If you have opened the <code class="docutils literal notranslate"><span class="pre">sample-metadata.tsv</span></code> file, you’ll see that there is a column called <code class="docutils literal notranslate"><span class="pre">barcode-sequence</span></code>. This column could be called nearly anything (there are some rules for what column names are allowed that we’ll cover later). As long as you specify the column name correctly when you call this action, it will know where to find the barcodes. Input and metadata parameters, in general, are files that you’re providing to a QIIME 2 action for actions to be performed on. They will never be modified by QIIME 2 - they are only viewed or read. In this command we’re also providing one parameter, specified by the option beginning with <code class="docutils literal notranslate"><span class="pre">--p-</span></code>. Parameters modify the behavior of an action, and parameters that don’t take any values (such as this one) are often referred to as <em>flags</em>. This particular parameter tells the action that the orientation of the barcodes in the sample metadata file are the reverse complement of the barcodes in the sequence data, and thus that the barcodes from the sample metadata should be reverse complemented before being used for demultiplexing. We’ll see examples of parameters that take a value later in this chapter. Finally, this command will generate two files as output, and we specify the paths (absolute or relative) where we want to store those files with output options. Output options always begin with <code class="docutils literal notranslate"><span class="pre">--o-</span></code> in QIIME 2. The first output created by this command was <code class="docutils literal notranslate"><span class="pre">demux.qza</span></code>, which contains our demultiplexed sequences (or sequences that have been grouped by sample). The second output created by this command is <code class="docutils literal notranslate"><span class="pre">demux-log.qza</span></code>. This is a log file that contains some details about this action.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./using"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="importing.html" title="previous page"><span class="section-number">3. </span>Importing data into QIIME 2</a>
    <a class='right-next' id="next-link" href="denoising.html" title="next page"><span class="section-number">5. </span>Denoising demultiplexed sequencing data</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By J Gregory Caporaso<br/>
        
            &copy; Copyright 2020-2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'G-KZHV37SG3H', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>